var qr=Object.defineProperty;var jt=e=>{throw TypeError(e)};var Ur=(e,t,r)=>t in e?qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var x=(e,t,r)=>Ur(e,typeof t!="symbol"?t+"":t,r),st=(e,t,r)=>t.has(e)||jt("Cannot "+r);var u=(e,t,r)=>(st(e,t,"read from private field"),r?r.call(e):t.get(e)),E=(e,t,r)=>t.has(e)?jt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),w=(e,t,r,s)=>(st(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),N=(e,t,r)=>(st(e,t,"access private method"),r);var At=(e,t,r,s)=>({set _(n){w(e,t,n,r)},get _(){return u(e,t,s)}});var tr={Stringify:1},M=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},Wr=/[&<>'"]/,rr=async(e,t)=>{let r="";t||(t=[]);const s=await Promise.all(e);for(let n=s.length-1;r+=s[n],n--,!(n<0);n--){let i=s[n];typeof i=="object"&&t.push(...i.callbacks||[]);const a=i.isEscaped;if(i=await(typeof i=="object"?i.toString():i),typeof i=="object"&&t.push(...i.callbacks||[]),i.isEscaped??a)r+=i;else{const o=[r];te(i,o),r=o[0]}}return M(r,t)},te=(e,t)=>{const r=e.search(Wr);if(r===-1){t[0]+=e;return}let s,n,i=0;for(n=r;n<e.length;n++){switch(e.charCodeAt(n)){case 34:s="&quot;";break;case 39:s="&#39;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}t[0]+=e.substring(i,n)+s,i=n+1}t[0]+=e.substring(i,n)},sr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],s={};return t.forEach(n=>n({phase:tr.Stringify,buffer:r,context:s})),r[0]},nr=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(n?n[0]+=e:n=[e],Promise.all(i.map(o=>o({phase:t,buffer:n,context:s}))).then(o=>Promise.all(o.filter(Boolean).map(l=>nr(l,t,!1,s,n))).then(()=>n[0]))):Promise.resolve(e)},zr=(e,...t)=>{const r=[""];for(let s=0,n=e.length-1;s<n;s++){r[0]+=e[s];const i=Array.isArray(t[s])?t[s].flat(1/0):[t[s]];for(let a=0,o=i.length;a<o;a++){const l=i[a];if(typeof l=="string")te(l,r);else if(typeof l=="number")r[0]+=l;else{if(typeof l=="boolean"||l===null||l===void 0)continue;if(typeof l=="object"&&l.isEscaped)if(l.callbacks)r.unshift("",l);else{const c=l.toString();c instanceof Promise?r.unshift("",c):r[0]+=c}else l instanceof Promise?r.unshift("",l):te(l.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?M(sr(M(r[0],r.callbacks))):M(r[0]):rr(r,r.callbacks)},xt=Symbol("RENDERER"),dt=Symbol("ERROR_HANDLER"),A=Symbol("STASH"),ir=Symbol("INTERNAL"),Br=Symbol("MEMO"),Ye=Symbol("PERMALINK"),Rt=e=>(e[ir]=!0,e),ar=e=>({value:t,children:r})=>{if(!r)return;const s={children:[{tag:Rt(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?s.children.push(...r.flat()):s.children.push(r),s.children.push({tag:Rt(()=>{e.pop()}),props:{}});const n={tag:"",props:s,type:""};return n[dt]=i=>{throw e.pop(),i},n},or=e=>{const t=[e],r=ar(t);return r.values=t,r.Provider=r,be.push(r),r},be=[],wt=e=>{const t=[e],r=s=>{t.push(s.value);let n;try{n=s.children?(Array.isArray(s.children)?new ur("",{},s.children):s.children).toString():""}finally{t.pop()}return n instanceof Promise?n.then(i=>M(i,i.callbacks)):M(n)};return r.values=t,r.Provider=r,r[xt]=ar(t),be.push(r),r},Se=e=>e.values.at(-1),ze={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},pt={},Be="data-precedence",_e=e=>Array.isArray(e)?e:[e],Pt=new WeakMap,Tt=(e,t,r,s)=>({buffer:n,context:i})=>{if(!n)return;const a=Pt.get(i)||{};Pt.set(i,a);const o=a[e]||(a[e]=[]);let l=!1;const c=ze[e];if(c.length>0){e:for(const[,f]of o)for(const d of c)if(((f==null?void 0:f[d])??null)===(r==null?void 0:r[d])){l=!0;break e}}if(l?n[0]=n[0].replaceAll(t,""):c.length>0?o.push([t,r,s]):o.unshift([t,r,s]),n[0].indexOf("</head>")!==-1){let f;if(s===void 0)f=o.map(([d])=>d);else{const d=[];f=o.map(([h,,g])=>{let v=d.indexOf(g);return v===-1&&(d.push(g),v=d.length-1),[h,v]}).sort((h,g)=>h[1]-g[1]).map(([h])=>h)}f.forEach(d=>{n[0]=n[0].replaceAll(d,"")}),n[0]=n[0].replace(/(?=<\/head>)/,f.join(""))}},Fe=(e,t,r)=>M(new F(e,r,_e(t??[])).toString()),He=(e,t,r,s)=>{if("itemProp"in r)return Fe(e,t,r);let{precedence:n,blocking:i,...a}=r;n=s?n??"":void 0,s&&(a[Be]=n);const o=new F(e,a,_e(t||[])).toString();return o instanceof Promise?o.then(l=>M(o,[...l.callbacks||[],Tt(e,l,a,n)])):M(o,[Tt(e,o,a,n)])},Gr=({children:e,...t})=>{const r=bt();if(r){const s=Se(r);if(s==="svg"||s==="head")return new F("title",t,_e(e??[]))}return He("title",e,t,!1)},Vr=({children:e,...t})=>{const r=bt();return["src","async"].some(s=>!t[s])||r&&Se(r)==="head"?Fe("script",e,t):He("script",e,t,!1)},Kr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,He("style",e,t,!0)):Fe("style",e,t),Jr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?Fe("link",e,t):He("link",e,t,"precedence"in t),Xr=({children:e,...t})=>{const r=bt();return r&&Se(r)==="head"?Fe("meta",e,t):He("meta",e,t,!1)},lr=(e,{children:t,...r})=>new F(e,r,_e(t??[])),Zr=e=>(typeof e.action=="function"&&(e.action=Ye in e.action?e.action[Ye]:void 0),lr("form",e)),cr=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=Ye in t.formAction?t.formAction[Ye]:void 0),lr(e,t)),Yr=e=>cr("input",e),Qr=e=>cr("button",e);const nt=Object.freeze(Object.defineProperty({__proto__:null,button:Qr,form:Zr,input:Yr,link:Jr,meta:Xr,script:Vr,style:Kr,title:Gr},Symbol.toStringTag,{value:"Module"}));var es=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),Qe=e=>es.get(e)||e,fr=(e,t)=>{for(const[r,s]of Object.entries(e)){const n=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);t(n,s==null?null:typeof s=="number"?n.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${s}`:`${s}px`:s)}},Pe=void 0,bt=()=>Pe,ts=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,rs=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],ss=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Et=(e,t)=>{for(let r=0,s=e.length;r<s;r++){const n=e[r];if(typeof n=="string")te(n,t);else{if(typeof n=="boolean"||n===null||n===void 0)continue;n instanceof F?n.toStringToBuffer(t):typeof n=="number"||n.isEscaped?t[0]+=n:n instanceof Promise?t.unshift("",n):Et(n,t)}}},F=class{constructor(e,t,r){x(this,"tag");x(this,"props");x(this,"key");x(this,"children");x(this,"isEscaped",!0);x(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([s,n])=>{s.values.push(n)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([s])=>{s.values.pop()})}return e.length===1?"callbacks"in e?sr(M(e[0],e.callbacks)).toString():e[0]:rr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:s}=this;e[0]+=`<${t}`;const n=Pe&&Se(Pe)==="svg"?i=>ts(Qe(i)):i=>Qe(i);for(let[i,a]of Object.entries(r))if(i=n(i),i!=="children"){if(i==="style"&&typeof a=="object"){let o="";fr(a,(l,c)=>{c!=null&&(o+=`${o?";":""}${l}:${c}`)}),e[0]+=' style="',te(o,e),e[0]+='"'}else if(typeof a=="string")e[0]+=` ${i}="`,te(a,e),e[0]+='"';else if(a!=null)if(typeof a=="number"||a.isEscaped)e[0]+=` ${i}="${a}"`;else if(typeof a=="boolean"&&ss.includes(i))a&&(e[0]+=` ${i}=""`);else if(i==="dangerouslySetInnerHTML"){if(s.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");s=[M(a.__html)]}else if(a instanceof Promise)e[0]+=` ${i}="`,e.unshift('"',a);else if(typeof a=="function"){if(!i.startsWith("on")&&i!=="ref")throw new Error(`Invalid prop '${i}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${i}="`,te(a.toString(),e),e[0]+='"'}if(rs.includes(t)&&s.length===0){e[0]+="/>";return}e[0]+=">",Et(s,e),e[0]+=`</${t}>`}},it=class extends F{toStringToBuffer(e){const{children:t}=this,r=this.tag.call(null,{...this.props,children:t.length<=1?t[0]:t});if(!(typeof r=="boolean"||r==null))if(r instanceof Promise)if(be.length===0)e.unshift("",r);else{const s=be.map(n=>[n,n.values.at(-1)]);e.unshift("",r.then(n=>(n instanceof F&&(n.localContexts=s),n)))}else r instanceof F?r.toStringToBuffer(e):typeof r=="number"||r.isEscaped?(e[0]+=r,r.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...r.callbacks))):te(r,e)}},ur=class extends F{toStringToBuffer(e){Et(this.children,e)}},Ot=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const s=t.key;delete t.key;const n=Ge(e,t,r);return n.key=s,n},kt=!1,Ge=(e,t,r)=>{if(!kt){for(const s in pt)nt[s][xt]=pt[s];kt=!0}return typeof e=="function"?new it(e,t,r):nt[e]?new it(nt[e],t,r):e==="svg"||e==="head"?(Pe||(Pe=wt("")),new F(e,t,[new it(Pe,{value:e},r)])):new F(e,t,r)},ns=({children:e})=>new ur("",{children:e},Array.isArray(e)?e:e?[e]:[]);function p(e,t,r){let s;if(!t||!("children"in t))s=Ge(e,t,[]);else{const n=t.children;s=Array.isArray(n)?Ge(e,t,n):Ge(e,t,[n])}return s.key=r,s}var Lt=(e,t,r)=>(s,n)=>{let i=-1;return a(0);async function a(o){if(o<=i)throw new Error("next() called multiple times");i=o;let l,c=!1,f;if(e[o]?(f=e[o][0][0],s.req.routeIndex=o):f=o===e.length&&n||void 0,f)try{l=await f(s,()=>a(o+1))}catch(d){if(d instanceof Error&&t)s.error=d,l=await t(d,s),c=!0;else throw d}else s.finalized===!1&&r&&(l=await r(s));return l&&(s.finalized===!1||c)&&(s.res=l),s}},is=Symbol(),as=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof vr?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?os(e,{all:r,dot:s}):{}};async function os(e,t){const r=await e.formData();return r?ls(r,t):{}}function ls(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?cs(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(fs(r,s,n),delete r[s])}),r}var cs=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},fs=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},hr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},us=e=>{const{groups:t,path:r}=hs(e),s=hr(r);return ds(s,t)},hs=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},ds=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},Ue={},ps=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return Ue[s]||(r[2]?Ue[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ue[s]=[e,r[1],!0]),Ue[s]}return null},Ct=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},ms=e=>Ct(e,decodeURI),dr=e=>{const t=e.url,r=t.indexOf("/",t.charCodeAt(9)===58?13:8);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return ms(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)},gs=e=>{const t=dr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},de=(e,t,...r)=>(r.length&&(t=de(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),pr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},at=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Ct(e,gr):e):e,mr=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){const o=e.charCodeAt(a+t.length+1);if(o===61){const l=a+t.length+2,c=e.indexOf("&",l);return at(e.slice(l,c===-1?void 0:c))}else if(o==38||isNaN(o))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let o=e.indexOf("=",i);o>a&&a!==-1&&(o=-1);let l=e.slice(i+1,o===-1?a===-1?void 0:a:o);if(s&&(l=at(l)),i=a,l==="")continue;let c;o===-1?c="":(c=e.slice(o+1,a===-1?void 0:a),s&&(c=at(c))),r?(n[l]&&Array.isArray(n[l])||(n[l]=[]),n[l].push(c)):n[l]??(n[l]=c)}return t?n[t]:n},vs=mr,ys=(e,t)=>mr(e,t,!0),gr=decodeURIComponent,$t=e=>Ct(e,gr),ge,$,G,yr,xr,mt,J,Gt,vr=(Gt=class{constructor(e,t="/",r=[[]]){E(this,G);x(this,"raw");E(this,ge);E(this,$);x(this,"routeIndex",0);x(this,"path");x(this,"bodyCache",{});E(this,J,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,w(this,$,r),w(this,ge,{})}param(e){return e?N(this,G,yr).call(this,e):N(this,G,xr).call(this)}query(e){return vs(this.url,e)}queries(e){return ys(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await as(this,e))}json(){return u(this,J).call(this,"text").then(e=>JSON.parse(e))}text(){return u(this,J).call(this,"text")}arrayBuffer(){return u(this,J).call(this,"arrayBuffer")}blob(){return u(this,J).call(this,"blob")}formData(){return u(this,J).call(this,"formData")}addValidatedData(e,t){u(this,ge)[e]=t}valid(e){return u(this,ge)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[is](){return u(this,$)}get matchedRoutes(){return u(this,$)[0].map(([[,e]])=>e)}get routePath(){return u(this,$)[0].map(([[,e]])=>e)[this.routeIndex].path}},ge=new WeakMap,$=new WeakMap,G=new WeakSet,yr=function(e){const t=u(this,$)[0][this.routeIndex][1][e],r=N(this,G,mt).call(this,t);return r?/\%/.test(r)?$t(r):r:void 0},xr=function(){const e={},t=Object.keys(u(this,$)[0][this.routeIndex][1]);for(const r of t){const s=N(this,G,mt).call(this,u(this,$)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?$t(s):s)}return e},mt=function(e){return u(this,$)[1]?u(this,$)[1][e]:e},J=new WeakMap,Gt),xs="text/plain; charset=UTF-8",ot=(e,t)=>({"Content-Type":e,...t}),ke,Le,U,ve,W,L,$e,ye,xe,ie,Me,De,X,pe,Vt,ws=(Vt=class{constructor(e,t){E(this,X);E(this,ke);E(this,Le);x(this,"env",{});E(this,U);x(this,"finalized",!1);x(this,"error");E(this,ve);E(this,W);E(this,L);E(this,$e);E(this,ye);E(this,xe);E(this,ie);E(this,Me);E(this,De);x(this,"render",(...e)=>(u(this,ye)??w(this,ye,t=>this.html(t)),u(this,ye).call(this,...e)));x(this,"setLayout",e=>w(this,$e,e));x(this,"getLayout",()=>u(this,$e));x(this,"setRenderer",e=>{w(this,ye,e)});x(this,"header",(e,t,r)=>{this.finalized&&w(this,L,new Response(u(this,L).body,u(this,L)));const s=u(this,L)?u(this,L).headers:u(this,ie)??w(this,ie,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});x(this,"status",e=>{w(this,ve,e)});x(this,"set",(e,t)=>{u(this,U)??w(this,U,new Map),u(this,U).set(e,t)});x(this,"get",e=>u(this,U)?u(this,U).get(e):void 0);x(this,"newResponse",(...e)=>N(this,X,pe).call(this,...e));x(this,"body",(e,t,r)=>N(this,X,pe).call(this,e,t,r));x(this,"text",(e,t,r)=>!u(this,ie)&&!u(this,ve)&&!t&&!r&&!this.finalized?new Response(e):N(this,X,pe).call(this,e,t,ot(xs,r)));x(this,"json",(e,t,r)=>N(this,X,pe).call(this,JSON.stringify(e),t,ot("application/json",r)));x(this,"html",(e,t,r)=>{const s=n=>N(this,X,pe).call(this,n,t,ot("text/html; charset=UTF-8",r));return typeof e=="object"?nr(e,tr.Stringify,!1,{}).then(s):s(e)});x(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});x(this,"notFound",()=>(u(this,xe)??w(this,xe,()=>new Response),u(this,xe).call(this,this)));w(this,ke,e),t&&(w(this,W,t.executionCtx),this.env=t.env,w(this,xe,t.notFoundHandler),w(this,De,t.path),w(this,Me,t.matchResult))}get req(){return u(this,Le)??w(this,Le,new vr(u(this,ke),u(this,De),u(this,Me))),u(this,Le)}get event(){if(u(this,W)&&"respondWith"in u(this,W))return u(this,W);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,W))return u(this,W);throw Error("This context has no ExecutionContext")}get res(){return u(this,L)||w(this,L,new Response(null,{headers:u(this,ie)??w(this,ie,new Headers)}))}set res(e){if(u(this,L)&&e){e=new Response(e.body,e);for(const[t,r]of u(this,L).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=u(this,L).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}w(this,L,e),this.finalized=!0}get var(){return u(this,U)?Object.fromEntries(u(this,U)):{}}},ke=new WeakMap,Le=new WeakMap,U=new WeakMap,ve=new WeakMap,W=new WeakMap,L=new WeakMap,$e=new WeakMap,ye=new WeakMap,xe=new WeakMap,ie=new WeakMap,Me=new WeakMap,De=new WeakMap,X=new WeakSet,pe=function(e,t,r){const s=u(this,L)?new Headers(u(this,L).headers):u(this,ie)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,o]of i)a.toLowerCase()==="set-cookie"?s.append(a,o):s.set(a,o)}if(r)for(const[i,a]of Object.entries(r))if(typeof a=="string")s.set(i,a);else{s.delete(i);for(const o of a)s.append(i,o)}const n=typeof t=="number"?t:(t==null?void 0:t.status)??u(this,ve);return new Response(e,{status:n,headers:s})},Vt),R="ALL",bs="all",Es=["get","post","put","delete","options","patch"],wr="Can not add a route since the matcher is already built.",br=class extends Error{},Cs="__COMPOSED_HANDLER",Ss=e=>e.text("404 Not Found",404),Mt=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},D,P,Cr,I,se,Ve,Ke,Kt,Er=(Kt=class{constructor(t={}){E(this,P);x(this,"get");x(this,"post");x(this,"put");x(this,"delete");x(this,"options");x(this,"patch");x(this,"all");x(this,"on");x(this,"use");x(this,"router");x(this,"getPath");x(this,"_basePath","/");E(this,D,"/");x(this,"routes",[]);E(this,I,Ss);x(this,"errorHandler",Mt);x(this,"onError",t=>(this.errorHandler=t,this));x(this,"notFound",t=>(w(this,I,t),this));x(this,"fetch",(t,...r)=>N(this,P,Ke).call(this,t,r[1],r[0],t.method));x(this,"request",(t,r,s,n)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,n):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${de("/",t)}`,r),s,n)));x(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(N(this,P,Ke).call(this,t.request,t,void 0,t.request.method))})});[...Es,bs].forEach(i=>{this[i]=(a,...o)=>(typeof a=="string"?w(this,D,a):N(this,P,se).call(this,i,u(this,D),a),o.forEach(l=>{N(this,P,se).call(this,i,u(this,D),l)}),this)}),this.on=(i,a,...o)=>{for(const l of[a].flat()){w(this,D,l);for(const c of[i].flat())o.map(f=>{N(this,P,se).call(this,c.toUpperCase(),u(this,D),f)})}return this},this.use=(i,...a)=>(typeof i=="string"?w(this,D,i):(w(this,D,"*"),a.unshift(i)),a.forEach(o=>{N(this,P,se).call(this,R,u(this,D),o)}),this);const{strict:s,...n}=t;Object.assign(this,n),this.getPath=s??!0?t.getPath??dr:gs}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{var a;let i;r.errorHandler===Mt?i=n.handler:(i=async(o,l)=>(await Lt([],r.errorHandler)(o,()=>n.handler(o,l))).res,i[Cs]=n.handler),N(a=s,P,se).call(a,n.method,n.path,i)}),this}basePath(t){const r=N(this,P,Cr).call(this);return r._basePath=de(this._basePath,t),r}mount(t,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,s.replaceRequest===!1?n=l=>l:n=s.replaceRequest));const a=i?l=>{const c=i(l);return Array.isArray(c)?c:[c]}:l=>{let c;try{c=l.executionCtx}catch{}return[l.env,c]};n||(n=(()=>{const l=de(this._basePath,t),c=l==="/"?0:l.length;return f=>{const d=new URL(f.url);return d.pathname=d.pathname.slice(c)||"/",new Request(d,f)}})());const o=async(l,c)=>{const f=await r(n(l.req.raw),...a(l));if(f)return f;await c()};return N(this,P,se).call(this,R,de(t,"*"),o),this}},D=new WeakMap,P=new WeakSet,Cr=function(){const t=new Er({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,w(t,I,u(this,I)),t.routes=this.routes,t},I=new WeakMap,se=function(t,r,s){t=t.toUpperCase(),r=de(this._basePath,r);const n={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)},Ve=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ke=function(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await N(this,P,Ke).call(this,t,r,s,"GET")))();const i=this.getPath(t,{env:s}),a=this.router.match(n,i),o=new ws(t,{path:i,matchResult:a,env:s,executionCtx:r,notFoundHandler:u(this,I)});if(a[0].length===1){let c;try{c=a[0][0][0][0](o,async()=>{o.res=await u(this,I).call(this,o)})}catch(f){return N(this,P,Ve).call(this,f,o)}return c instanceof Promise?c.then(f=>f||(o.finalized?o.res:u(this,I).call(this,o))).catch(f=>N(this,P,Ve).call(this,f,o)):c??u(this,I).call(this,o)}const l=Lt(a[0],this.errorHandler,u(this,I));return(async()=>{try{const c=await l(o);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return N(this,P,Ve).call(this,c,o)}})()},Kt),et="[^/]+",Ae=".*",Re="(?:|/.*)",me=Symbol(),Ns=new Set(".\\+*[^]$()");function js(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Ae||e===Re?1:t===Ae||t===Re?-1:e===et?1:t===et?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ae,oe,_,Jt,gt=(Jt=class{constructor(){E(this,ae);E(this,oe);E(this,_,Object.create(null))}insert(t,r,s,n,i){if(t.length===0){if(u(this,ae)!==void 0)throw me;if(i)return;w(this,ae,r);return}const[a,...o]=t,l=a==="*"?o.length===0?["","",Ae]:["","",et]:a==="/*"?["","",Re]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let c;if(l){const f=l[1];let d=l[2]||et;if(f&&l[2]&&(d===".*"||(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d))))throw me;if(c=u(this,_)[d],!c){if(Object.keys(u(this,_)).some(h=>h!==Ae&&h!==Re))throw me;if(i)return;c=u(this,_)[d]=new gt,f!==""&&w(c,oe,n.varIndex++)}!i&&f!==""&&s.push([f,u(c,oe)])}else if(c=u(this,_)[a],!c){if(Object.keys(u(this,_)).some(f=>f.length>1&&f!==Ae&&f!==Re))throw me;if(i)return;c=u(this,_)[a]=new gt}c.insert(o,r,s,n,i)}buildRegExpStr(){const r=Object.keys(u(this,_)).sort(js).map(s=>{const n=u(this,_)[s];return(typeof u(n,oe)=="number"?`(${s})@${u(n,oe)}`:Ns.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof u(this,ae)=="number"&&r.unshift(`#${u(this,ae)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},ae=new WeakMap,oe=new WeakMap,_=new WeakMap,Jt),tt,Ie,Xt,As=(Xt=class{constructor(){E(this,tt,{varIndex:0});E(this,Ie,new gt)}insert(e,t,r){const s=[],n=[];for(let a=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,l=>{const c=`@\\${a}`;return n[a]=[c,l],a++,o=!0,c}),!o)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[o]=n[a];for(let l=i.length-1;l>=0;l--)if(i[l].indexOf(o)!==-1){i[l]=i[l].replace(o,n[a][1]);break}}return u(this,Ie).insert(i,t,s,u(this,tt),r),s}buildRegExp(){let e=u(this,Ie).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},tt=new WeakMap,Ie=new WeakMap,Xt),Sr=[],Rs=[/^$/,[],Object.create(null)],Je=Object.create(null);function Nr(e){return Je[e]??(Je[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ps(){Je=Object.create(null)}function Ts(e){var c;const t=new As,r=[];if(e.length===0)return Rs;const s=e.map(f=>[!/\*|\/:/.test(f[0]),...f]).sort(([f,d],[h,g])=>f?1:h?-1:d.length-g.length),n=Object.create(null);for(let f=0,d=-1,h=s.length;f<h;f++){const[g,v,m]=s[f];g?n[v]=[m.map(([b])=>[b,Object.create(null)]),Sr]:d++;let y;try{y=t.insert(v,d,g)}catch(b){throw b===me?new br(v):b}g||(r[d]=m.map(([b,C])=>{const j=Object.create(null);for(C-=1;C>=0;C--){const[S,O]=y[C];j[S]=O}return[b,j]}))}const[i,a,o]=t.buildRegExp();for(let f=0,d=r.length;f<d;f++)for(let h=0,g=r[f].length;h<g;h++){const v=(c=r[f][h])==null?void 0:c[1];if(!v)continue;const m=Object.keys(v);for(let y=0,b=m.length;y<b;y++)v[m[y]]=o[v[m[y]]]}const l=[];for(const f in a)l[f]=r[a[f]];return[i,l,n]}function ue(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Nr(r).test(t))return[...e[r]]}}var Z,Y,Ce,jr,Ar,Zt,Os=(Zt=class{constructor(){E(this,Ce);x(this,"name","RegExpRouter");E(this,Z);E(this,Y);w(this,Z,{[R]:Object.create(null)}),w(this,Y,{[R]:Object.create(null)})}add(e,t,r){var o;const s=u(this,Z),n=u(this,Y);if(!s||!n)throw new Error(wr);s[e]||[s,n].forEach(l=>{l[e]=Object.create(null),Object.keys(l[R]).forEach(c=>{l[e][c]=[...l[R][c]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const l=Nr(t);e===R?Object.keys(s).forEach(c=>{var f;(f=s[c])[t]||(f[t]=ue(s[c],t)||ue(s[R],t)||[])}):(o=s[e])[t]||(o[t]=ue(s[e],t)||ue(s[R],t)||[]),Object.keys(s).forEach(c=>{(e===R||e===c)&&Object.keys(s[c]).forEach(f=>{l.test(f)&&s[c][f].push([r,i])})}),Object.keys(n).forEach(c=>{(e===R||e===c)&&Object.keys(n[c]).forEach(f=>l.test(f)&&n[c][f].push([r,i]))});return}const a=pr(t)||[t];for(let l=0,c=a.length;l<c;l++){const f=a[l];Object.keys(n).forEach(d=>{var h;(e===R||e===d)&&((h=n[d])[f]||(h[f]=[...ue(s[d],f)||ue(s[R],f)||[]]),n[d][f].push([r,i-c+l+1]))})}}match(e,t){Ps();const r=N(this,Ce,jr).call(this);return this.match=(s,n)=>{const i=r[s]||r[R],a=i[2][n];if(a)return a;const o=n.match(i[0]);if(!o)return[[],Sr];const l=o.indexOf("",1);return[i[1][l],o]},this.match(e,t)}},Z=new WeakMap,Y=new WeakMap,Ce=new WeakSet,jr=function(){const e=Object.create(null);return Object.keys(u(this,Y)).concat(Object.keys(u(this,Z))).forEach(t=>{e[t]||(e[t]=N(this,Ce,Ar).call(this,t))}),w(this,Z,w(this,Y,void 0)),e},Ar=function(e){const t=[];let r=e===R;return[u(this,Z),u(this,Y)].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==R&&t.push(...Object.keys(s[R]).map(i=>[i,s[R][i]]))}),r?Ts(t):null},Zt),Q,z,Yt,ks=(Yt=class{constructor(e){x(this,"name","SmartRouter");E(this,Q,[]);E(this,z,[]);w(this,Q,e.routers)}add(e,t,r){if(!u(this,z))throw new Error(wr);u(this,z).push([e,t,r])}match(e,t){if(!u(this,z))throw new Error("Fatal error");const r=u(this,Q),s=u(this,z),n=r.length;let i=0,a;for(;i<n;i++){const o=r[i];try{for(let l=0,c=s.length;l<c;l++)o.add(...s[l]);a=o.match(e,t)}catch(l){if(l instanceof br)continue;throw l}this.match=o.match.bind(o),w(this,Q,[o]),w(this,z,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(u(this,z)||u(this,Q).length!==1)throw new Error("No active router has been determined yet.");return u(this,Q)[0]}},Q=new WeakMap,z=new WeakMap,Yt),Ne=Object.create(null),ee,k,le,we,T,B,ne,Qt,Rr=(Qt=class{constructor(e,t,r){E(this,B);E(this,ee);E(this,k);E(this,le);E(this,we,0);E(this,T,Ne);if(w(this,k,r||Object.create(null)),w(this,ee,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},w(this,ee,[s])}w(this,le,[])}insert(e,t,r){w(this,we,++At(this,we)._);let s=this;const n=us(t),i=[];for(let a=0,o=n.length;a<o;a++){const l=n[a],c=n[a+1],f=ps(l,c),d=Array.isArray(f)?f[0]:l;if(d in u(s,k)){s=u(s,k)[d],f&&i.push(f[1]);continue}u(s,k)[d]=new Rr,f&&(u(s,le).push(f),i.push(f[1])),s=u(s,k)[d]}return u(s,ee).push({[e]:{handler:r,possibleKeys:i.filter((a,o,l)=>l.indexOf(a)===o),score:u(this,we)}}),s}search(e,t){var o;const r=[];w(this,T,Ne);let n=[this];const i=hr(t),a=[];for(let l=0,c=i.length;l<c;l++){const f=i[l],d=l===c-1,h=[];for(let g=0,v=n.length;g<v;g++){const m=n[g],y=u(m,k)[f];y&&(w(y,T,u(m,T)),d?(u(y,k)["*"]&&r.push(...N(this,B,ne).call(this,u(y,k)["*"],e,u(m,T))),r.push(...N(this,B,ne).call(this,y,e,u(m,T)))):h.push(y));for(let b=0,C=u(m,le).length;b<C;b++){const j=u(m,le)[b],S=u(m,T)===Ne?{}:{...u(m,T)};if(j==="*"){const K=u(m,k)["*"];K&&(r.push(...N(this,B,ne).call(this,K,e,u(m,T))),w(K,T,S),h.push(K));continue}const[O,fe,re]=j;if(!f&&!(re instanceof RegExp))continue;const H=u(m,k)[O],Hr=i.slice(l).join("/");if(re instanceof RegExp){const K=re.exec(Hr);if(K){if(S[fe]=K[0],r.push(...N(this,B,ne).call(this,H,e,u(m,T),S)),Object.keys(u(H,k)).length){w(H,T,S);const rt=((o=K[0].match(/\//))==null?void 0:o.length)??0;(a[rt]||(a[rt]=[])).push(H)}continue}}(re===!0||re.test(f))&&(S[fe]=f,d?(r.push(...N(this,B,ne).call(this,H,e,S,u(m,T))),u(H,k)["*"]&&r.push(...N(this,B,ne).call(this,u(H,k)["*"],e,S,u(m,T)))):(w(H,T,S),h.push(H)))}}n=h.concat(a.shift()??[])}return r.length>1&&r.sort((l,c)=>l.score-c.score),[r.map(({handler:l,params:c})=>[l,c])]}},ee=new WeakMap,k=new WeakMap,le=new WeakMap,we=new WeakMap,T=new WeakMap,B=new WeakSet,ne=function(e,t,r,s){const n=[];for(let i=0,a=u(e,ee).length;i<a;i++){const o=u(e,ee)[i],l=o[t]||o[R],c={};if(l!==void 0&&(l.params=Object.create(null),n.push(l),r!==Ne||s&&s!==Ne))for(let f=0,d=l.possibleKeys.length;f<d;f++){const h=l.possibleKeys[f],g=c[l.score];l.params[h]=s!=null&&s[h]&&!g?s[h]:r[h]??(s==null?void 0:s[h]),c[l.score]=!0}}return n},Qt),ce,er,Ls=(er=class{constructor(){x(this,"name","TrieRouter");E(this,ce);w(this,ce,new Rr)}add(e,t,r){const s=pr(t);if(s){for(let n=0,i=s.length;n<i;n++)u(this,ce).insert(e,s[n],r);return}u(this,ce).insert(e,t,r)}match(e,t){return u(this,ce).search(e,t)}},ce=new WeakMap,er),Pr=class extends Er{constructor(e={}){super(e),this.router=e.router??new ks({routers:[new Os,new Ls]})}},$s=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),n=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,o){var f;function l(d,h){a.res.headers.set(d,h)}const c=s(a.req.header("origin")||"",a);if(c&&l("Access-Control-Allow-Origin",c),r.origin!=="*"){const d=a.req.header("Vary");d?l("Vary",d):l("Vary","Origin")}if(r.credentials&&l("Access-Control-Allow-Credentials","true"),(f=r.exposeHeaders)!=null&&f.length&&l("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.maxAge!=null&&l("Access-Control-Max-Age",r.maxAge.toString());const d=n(a.req.header("origin")||"",a);d.length&&l("Access-Control-Allow-Methods",d.join(","));let h=r.allowHeaders;if(!(h!=null&&h.length)){const g=a.req.header("Access-Control-Request-Headers");g&&(h=g.split(/\s*,\s*/))}return h!=null&&h.length&&(l("Access-Control-Allow-Headers",h.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await o()}},Ms=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Dt=(e,t=Is)=>{const r=/\.([a-zA-Z0-9]+?)$/,s=e.match(r);if(!s)return;let n=t[s[1]];return n&&n.startsWith("text")&&(n+="; charset=utf-8"),n},Ds={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Is=Ds,_s=(...e)=>{let t=e.filter(n=>n!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),s=[];for(const n of r)n===".."&&s.length>0&&s.at(-1)!==".."?s.pop():n!=="."&&s.push(n);return s.join("/")||"."},Tr={br:".br",zstd:".zst",gzip:".gz"},Fs=Object.keys(Tr),Hs="index.html",qs=e=>{const t=e.root??"./",r=e.path,s=e.join??_s;return async(n,i)=>{var f,d,h,g;if(n.finalized)return i();let a;if(e.path)a=e.path;else try{if(a=decodeURIComponent(n.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(a))throw new Error}catch{return await((f=e.onNotFound)==null?void 0:f.call(e,n.req.path,n)),i()}let o=s(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(a):a);e.isDir&&await e.isDir(o)&&(o=s(o,Hs));const l=e.getContent;let c=await l(o,n);if(c instanceof Response)return n.newResponse(c.body,c);if(c){const v=e.mimes&&Dt(o,e.mimes)||Dt(o);if(n.header("Content-Type",v||"application/octet-stream"),e.precompressed&&(!v||Ms.test(v))){const m=new Set((d=n.req.header("Accept-Encoding"))==null?void 0:d.split(",").map(y=>y.trim()));for(const y of Fs){if(!m.has(y))continue;const b=await l(o+Tr[y],n);if(b){c=b,n.header("Content-Encoding",y),n.header("Vary","Accept-Encoding",{append:!0});break}}}return await((h=e.onFound)==null?void 0:h.call(e,o,n)),n.body(c)}await((g=e.onNotFound)==null?void 0:g.call(e,o,n)),await i()}},Us=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let s;t&&t.namespace?s=t.namespace:s=__STATIC_CONTENT;const n=r[e]||e;if(!n)return null;const i=await s.get(n,{type:"stream"});return i||null},Ws=e=>async function(r,s){return qs({...e,getContent:async i=>Us(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,s)},zs=e=>Ws(e),Te="_hp",Bs={Change:"Input",DoubleClick:"DblClick"},Gs={svg:"2000/svg",math:"1998/Math/MathML"},Oe=[],vt=new WeakMap,Ee=void 0,Vs=()=>Ee,q=e=>"t"in e,lt={onClick:["click",!1]},It=e=>{if(!e.startsWith("on"))return;if(lt[e])return lt[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,s]=t;return lt[e]=[(Bs[r]||r).toLowerCase(),!!s]}},_t=(e,t)=>Ee&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,Ks=(e,t,r)=>{var s;t||(t={});for(let n in t){const i=t[n];if(n!=="children"&&(!r||r[n]!==i)){n=Qe(n);const a=It(n);if(a){if((r==null?void 0:r[n])!==i&&(r&&e.removeEventListener(a[0],r[n],a[1]),i!=null)){if(typeof i!="function")throw new Error(`Event handler for "${n}" is not a function`);e.addEventListener(a[0],i,a[1])}}else if(n==="dangerouslySetInnerHTML"&&i)e.innerHTML=i.__html;else if(n==="ref"){let o;typeof i=="function"?o=i(e)||(()=>i(null)):i&&"current"in i&&(i.current=e,o=()=>i.current=null),vt.set(e,o)}else if(n==="style"){const o=e.style;typeof i=="string"?o.cssText=i:(o.cssText="",i!=null&&fr(i,o.setProperty.bind(o)))}else{if(n==="value"){const l=e.nodeName;if(l==="INPUT"||l==="TEXTAREA"||l==="SELECT"){if(e.value=i==null||i===!1?null:i,l==="TEXTAREA"){e.textContent=i;continue}else if(l==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(n==="checked"&&e.nodeName==="INPUT"||n==="selected"&&e.nodeName==="OPTION")&&(e[n]=i);const o=_t(e,n);i==null||i===!1?e.removeAttribute(o):i===!0?e.setAttribute(o,""):typeof i=="string"||typeof i=="number"?e.setAttribute(o,i):e.setAttribute(o,i.toString())}}}if(r)for(let n in r){const i=r[n];if(n!=="children"&&!(n in t)){n=Qe(n);const a=It(n);a?e.removeEventListener(a[0],i,a[1]):n==="ref"?(s=vt.get(e))==null||s():e.removeAttribute(_t(e,n))}}},Js=(e,t)=>{t[A][0]=0,Oe.push([e,t]);const r=t.tag[xt]||t.tag,s=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,s)]}finally{Oe.pop()}},Or=(e,t,r,s,n)=>{var i,a;(i=e.vR)!=null&&i.length&&(s.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((a=e[A][1][Mr])==null||a.forEach(o=>n.push(o))),e.vC.forEach(o=>{var l;if(q(o))r.push(o);else if(typeof o.tag=="function"||o.tag===""){o.c=t;const c=r.length;if(Or(o,t,r,s,n),o.s){for(let f=c;f<r.length;f++)r[f].s=!0;o.s=!1}}else r.push(o),(l=o.vR)!=null&&l.length&&(s.push(...o.vR),delete o.vR)})},Xs=e=>{for(;;e=e.tag===Te||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==Te&&e.e)return e.e}},kr=e=>{var t,r,s,n,i,a;q(e)||((r=(t=e[A])==null?void 0:t[1][Mr])==null||r.forEach(o=>{var l;return(l=o[2])==null?void 0:l.call(o)}),(s=vt.get(e.e))==null||s(),e.p===2&&((n=e.vC)==null||n.forEach(o=>o.p=2)),(i=e.vC)==null||i.forEach(kr)),e.p||((a=e.e)==null||a.remove(),delete e.e),typeof e.tag=="function"&&(je.delete(e),Xe.delete(e),delete e[A][3],e.a=!0)},Lr=(e,t,r)=>{e.c=t,$r(e,t,r)},Ft=(e,t)=>{if(t){for(let r=0,s=e.length;r<s;r++)if(e[r]===t)return r}},Ht=Symbol(),$r=(e,t,r)=>{var c;const s=[],n=[],i=[];Or(e,t,s,n,i),n.forEach(kr);const a=r?void 0:t.childNodes;let o,l=null;if(r)o=-1;else if(!a.length)o=0;else{const f=Ft(a,Xs(e.nN));f!==void 0?(l=a[f],o=f):o=Ft(a,(c=s.find(d=>d.tag!==Te&&d.e))==null?void 0:c.e)??-1,o===-1&&(r=!0)}for(let f=0,d=s.length;f<d;f++,o++){const h=s[f];let g;if(h.s&&h.e)g=h.e,h.s=!1;else{const v=r||!h.e;q(h)?(h.e&&h.d&&(h.e.textContent=h.t),h.d=!1,g=h.e||(h.e=document.createTextNode(h.t))):(g=h.e||(h.e=h.n?document.createElementNS(h.n,h.tag):document.createElement(h.tag)),Ks(g,h.props,h.pP),$r(h,g,v))}h.tag===Te?o--:r?g.parentNode||t.appendChild(g):a[o]!==g&&a[o-1]!==g&&(a[o+1]===g?t.appendChild(a[o]):t.insertBefore(g,l||a[o]||null))}if(e.pP&&delete e.pP,i.length){const f=[],d=[];i.forEach(([,h,,g,v])=>{h&&f.push(h),g&&d.push(g),v==null||v()}),f.forEach(h=>h()),d.length&&requestAnimationFrame(()=>{d.forEach(h=>h())})}},Zs=(e,t)=>!!(e&&e.length===t.length&&e.every((r,s)=>r[1]===t[s][1])),Xe=new WeakMap,yt=(e,t,r)=>{var i,a,o,l,c,f;const s=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let n;try{r||(r=typeof t.tag=="function"?Js(e,t):_e(t.props.children)),((i=r[0])==null?void 0:i.tag)===""&&r[0][dt]&&(n=r[0][dt],e[5].push([e,n,t]));const d=s?[...t.pC]:t.vC?[...t.vC]:void 0,h=[];let g;for(let v=0;v<r.length;v++){Array.isArray(r[v])&&r.splice(v,1,...r[v].flat());let m=Ys(r[v]);if(m){typeof m.tag=="function"&&!m.tag[ir]&&(be.length>0&&(m[A][2]=be.map(b=>[b,b.values.at(-1)])),(a=e[5])!=null&&a.length&&(m[A][3]=e[5].at(-1)));let y;if(d&&d.length){const b=d.findIndex(q(m)?C=>q(C):m.key!==void 0?C=>C.key===m.key&&C.tag===m.tag:C=>C.tag===m.tag);b!==-1&&(y=d[b],d.splice(b,1))}if(y)if(q(m))y.t!==m.t&&(y.t=m.t,y.d=!0),m=y;else{const b=y.pP=y.props;if(y.props=m.props,y.f||(y.f=m.f||t.f),typeof m.tag=="function"){const C=y[A][2];y[A][2]=m[A][2]||[],y[A][3]=m[A][3],!y.f&&((y.o||y)===m.o||(l=(o=y.tag)[Br])!=null&&l.call(o,b,y.props))&&Zs(C,y[A][2])&&(y.s=!0)}m=y}else if(!q(m)&&Ee){const b=Se(Ee);b&&(m.n=b)}if(!q(m)&&!m.s&&(yt(e,m),delete m.f),h.push(m),g&&!g.s&&!m.s)for(let b=g;b&&!q(b);b=(c=b.vC)==null?void 0:c.at(-1))b.nN=m;g=m}}t.vR=s?[...t.vC,...d||[]]:d||[],t.vC=h,s&&delete t.pC}catch(d){if(t.f=!0,d===Ht){if(n)return;throw d}const[h,g,v]=((f=t[A])==null?void 0:f[3])||[];if(g){const m=()=>Ze([0,!1,e[2]],v),y=Xe.get(v)||[];y.push(m),Xe.set(v,y);const b=g(d,()=>{const C=Xe.get(v);if(C){const j=C.indexOf(m);if(j!==-1)return C.splice(j,1),m()}});if(b){if(e[0]===1)e[1]=!0;else if(yt(e,v,[b]),(g.length===1||e!==h)&&v.c){Lr(v,v.c,!1);return}throw Ht}}throw d}finally{n&&e[5].pop()}},Ys=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[A]=[0,[]];else{const t=Gs[e.tag];t&&(Ee||(Ee=or("")),e.props.children=[{tag:Ee,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},qt=(e,t)=>{var r,s;(r=t[A][2])==null||r.forEach(([n,i])=>{n.values.push(i)});try{yt(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(s=t[A][2])==null||s.forEach(([n])=>{n.values.pop()}),(e[0]!==1||!e[1])&&Lr(t,t.c,!1)},je=new WeakMap,Ut=[],Ze=async(e,t)=>{e[5]||(e[5]=[]);const r=je.get(t);r&&r[0](void 0);let s;const n=new Promise(i=>s=i);if(je.set(t,[s,()=>{e[2]?e[2](e,t,i=>{qt(i,t)}).then(()=>s(t)):(qt(e,t),s(t))}]),Ut.length)Ut.at(-1).add(t);else{await Promise.resolve();const i=je.get(t);i&&(je.delete(t),i[1]())}return n},Qs=(e,t,r)=>({tag:Te,props:{children:e},key:r,e:t,p:1}),ct=0,Mr=1,ft=2,ut=3,ht=new WeakMap,Dr=(e,t)=>!e||!t||e.length!==t.length||t.some((r,s)=>r!==e[s]),en=void 0,Wt=[],tn=e=>{var a;const t=()=>typeof e=="function"?e():e,r=Oe.at(-1);if(!r)return[t(),()=>{}];const[,s]=r,n=(a=s[A][1])[ct]||(a[ct]=[]),i=s[A][0]++;return n[i]||(n[i]=[t(),o=>{const l=en,c=n[i];if(typeof o=="function"&&(o=o(c[0])),!Object.is(o,c[0]))if(c[0]=o,Wt.length){const[f,d]=Wt.at(-1);Promise.all([f===3?s:Ze([f,!1,l],s),d]).then(([h])=>{if(!h||!(f===2||f===3))return;const g=h.vC;requestAnimationFrame(()=>{setTimeout(()=>{g===h.vC&&Ze([f===3?1:0,!1,l],h)})})})}else Ze([0,!1,l],s)}])},St=(e,t)=>{var o;const r=Oe.at(-1);if(!r)return e;const[,s]=r,n=(o=s[A][1])[ft]||(o[ft]=[]),i=s[A][0]++,a=n[i];return Dr(a==null?void 0:a[1],t)?n[i]=[e,t]:e=n[i][0],e},rn=e=>{const t=ht.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>ht.set(e,[r]),r=>ht.set(e,[void 0,r])),e},sn=(e,t)=>{var o;const r=Oe.at(-1);if(!r)return e();const[,s]=r,n=(o=s[A][1])[ut]||(o[ut]=[]),i=s[A][0]++,a=n[i];return Dr(a==null?void 0:a[1],t)&&(n[i]=[e(),t]),n[i][0]},nn=or({pending:!1,data:null,method:null,action:null}),zt=new Set,an=e=>{zt.add(e),e.finally(()=>zt.delete(e))},Nt=(e,t)=>sn(()=>r=>{let s;e&&(typeof e=="function"?s=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,s=()=>{e.current=null}));const n=t(r);return()=>{n==null||n(),s==null||s()}},[e]),he=Object.create(null),We=Object.create(null),qe=(e,t,r,s,n)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const i=document.head;let{onLoad:a,onError:o,precedence:l,blocking:c,...f}=t,d=null,h=!1;const g=ze[e];let v;if(g.length>0){const C=i.querySelectorAll(e);e:for(const j of C)for(const S of ze[e])if(j.getAttribute(S)===t[S]){d=j;break e}if(!d){const j=g.reduce((S,O)=>t[O]===void 0?S:`${S}-${O}-${t[O]}`,e);h=!We[j],d=We[j]||(We[j]=(()=>{const S=document.createElement(e);for(const O of g)t[O]!==void 0&&S.setAttribute(O,t[O]),t.rel&&S.setAttribute("rel",t.rel);return S})())}}else v=i.querySelectorAll(e);l=s?l??"":void 0,s&&(f[Be]=l);const m=St(C=>{if(g.length>0){let j=!1;for(const S of i.querySelectorAll(e)){if(j&&S.getAttribute(Be)!==l){i.insertBefore(C,S);return}S.getAttribute(Be)===l&&(j=!0)}i.appendChild(C)}else if(v){let j=!1;for(const S of v)if(S===C){j=!0;break}j||i.insertBefore(C,i.contains(v[0])?v[0]:i.querySelector(e)),v=void 0}},[l]),y=Nt(t.ref,C=>{var O;const j=g[0];if(r===2&&(C.innerHTML=""),(h||v)&&m(C),!o&&!a)return;let S=he[O=C.getAttribute(j)]||(he[O]=new Promise((fe,re)=>{C.addEventListener("load",fe),C.addEventListener("error",re)}));a&&(S=S.then(a)),o&&(S=S.catch(o)),S.catch(()=>{})});if(n&&c==="render"){const C=ze[e][0];if(t[C]){const j=t[C],S=he[j]||(he[j]=new Promise((O,fe)=>{m(d),d.addEventListener("load",O),d.addEventListener("error",fe)}));rn(S)}}const b={tag:e,type:e,props:{...f,ref:y},ref:y};return b.p=r,d&&(b.e=d),Qs(b,i)},on=e=>{const t=Vs(),r=t&&Se(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:qe("title",e,void 0,!1,!1)},ln=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:qe("script",e,1,!1,!0),cn=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,qe("style",e,2,!0,!0)),fn=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:qe("link",e,1,"precedence"in e,!0),un=e=>qe("meta",e,void 0,!1,!1),Ir=Symbol(),hn=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[s,n]=tn([null,!1]),i=St(async c=>{const f=c.isTrusted?t:c.detail[Ir];if(typeof f!="function")return;c.preventDefault();const d=new FormData(c.target);n([d,!0]);const h=f(d);h instanceof Promise&&(an(h),await h),n([null,!0])},[]),a=Nt(e.ref,c=>(c.addEventListener("submit",i),()=>{c.removeEventListener("submit",i)})),[o,l]=s;return s[1]=!1,{tag:nn,props:{value:{pending:o!==null,data:o,method:o?"post":null,action:o?t:null},children:{tag:"form",props:{...r,ref:a},type:"form",ref:a}},f:l}},_r=(e,{formAction:t,...r})=>{if(typeof t=="function"){const s=St(n=>{n.preventDefault(),n.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Ir]:t}}))},[]);r.ref=Nt(r.ref,n=>(n.addEventListener("click",s),()=>{n.removeEventListener("click",s)}))}return{tag:e,props:r,type:e,ref:r.ref}},dn=e=>_r("input",e),pn=e=>_r("button",e);Object.assign(pt,{title:on,script:ln,style:cn,link:fn,meta:un,form:hn,input:dn,button:pn});wt(null);new TextEncoder;var mn=wt(null),gn=(e,t,r,s)=>(n,i)=>{const a="<!DOCTYPE html>",o=r?Ot(c=>r(c,e),{Layout:t,...i},n):n,l=zr`${M(a)}${Ot(mn.Provider,{value:e},o)}`;return e.html(l)},vn=(e,t)=>function(s,n){const i=s.getLayout()??ns;return e&&s.setLayout(a=>e({...a,Layout:i},s)),s.setRenderer(gn(s,i,e)),n()};const yn=vn(({children:e,title:t})=>p("html",{lang:"ru",children:[p("head",{children:[p("meta",{charset:"utf-8"}),p("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),p("title",{children:t}),p("script",{src:"https://cdn.tailwindcss.com"}),p("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),p("style",{children:`
          .fade-in {
            animation: fadeIn 0.5s ease-in;
          }
          @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
          }
        `})]}),p("body",{children:e})]})),V=new Pr;V.use("/api/*",$s());V.use("/static/*",zs({root:"./public"}));V.get("/",yn,e=>e.render(p("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[p("div",{className:"container mx-auto px-4 py-8",children:[p("header",{className:"text-center mb-12",children:[p("h1",{className:"text-4xl font-bold text-gray-800 mb-4",children:[p("i",{className:"fas fa-sitemap mr-3"}),"Организационная структура"]}),p("p",{className:"text-gray-600 text-lg",children:"Загрузите документ и постройте интерактивную организационную диаграмму"})]}),p("div",{className:"max-w-4xl mx-auto mb-12",children:p("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[p("h2",{className:"text-2xl font-semibold mb-6 text-gray-700",children:[p("i",{className:"fas fa-upload mr-2"}),"Загрузить документ"]}),p("div",{className:"mb-6",children:p("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-500 transition-colors",children:[p("input",{type:"file",id:"fileInput",className:"hidden",accept:".pdf,.docx,.xlsx,.pptx",onChange:"handleFileUpload(event)"}),p("label",{htmlFor:"fileInput",className:"cursor-pointer",children:[p("i",{className:"fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"}),p("p",{className:"text-gray-600 mb-2",children:["Перетащите файл сюда или ",p("span",{className:"text-indigo-600 font-semibold",children:"выберите файл"})]}),p("p",{className:"text-sm text-gray-500",children:"Поддерживаются: PDF, DOCX, XLSX, PPTX"})]})]})}),p("div",{className:"mb-6",children:[p("h3",{className:"text-lg font-medium mb-3 text-gray-700",children:[p("i",{className:"fab fa-google mr-2"}),"Импорт из Google Sheets"]}),p("div",{className:"flex gap-2",children:[p("input",{type:"text",id:"googleSheetsUrl",placeholder:"Вставьте ссылку на Google Sheets...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),p("button",{onClick:"importFromGoogleSheets()",className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[p("i",{className:"fas fa-download mr-2"}),"Импортировать"]})]})]}),p("div",{className:"mb-6",children:p("button",{onClick:"showManualInput()",className:"w-full px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[p("i",{className:"fas fa-edit mr-2"}),"Создать структуру вручную"]})})]})}),p("div",{id:"chartContainer",className:"hidden",children:p("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[p("div",{className:"flex justify-between items-center mb-6",children:[p("h2",{className:"text-2xl font-semibold text-gray-700",children:[p("i",{className:"fas fa-network-wired mr-2"}),"Организационная диаграмма"]}),p("div",{className:"flex gap-2",children:[p("button",{onClick:"exportToGoogleSheets()",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[p("i",{className:"fas fa-file-export mr-2"}),"Экспорт в Google Sheets"]}),p("button",{onClick:"downloadAsJSON()",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[p("i",{className:"fas fa-download mr-2"}),"Скачать JSON"]}),p("button",{onClick:"editStructure()",className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:[p("i",{className:"fas fa-pen mr-2"}),"Редактировать"]})]})]}),p("div",{id:"orgChart",className:"overflow-x-auto"})]})}),p("div",{id:"manualInputModal",className:"hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p("div",{className:"bg-white rounded-lg p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[p("h3",{className:"text-2xl font-semibold mb-6",children:"Создать структуру вручную"}),p("div",{id:"manualInputForm",children:[p("div",{className:"mb-4",children:[p("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Структура организации (JSON или текст)"}),p("textarea",{id:"manualStructureInput",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",rows:"10",placeholder:`Пример JSON:\r
{\r
  "name": "CEO",\r
  "title": "Генеральный директор",\r
  "children": [\r
    {\r
      "name": "CTO",\r
      "title": "Технический директор",\r
      "children": []\r
    }\r
  ]\r
}\r
\r
Или текстовый формат:\r
CEO - Генеральный директор\r
  CTO - Технический директор\r
    Разработчик 1\r
    Разработчик 2\r
  CFO - Финансовый директор`})]}),p("div",{className:"flex gap-2",children:[p("button",{onClick:"processManualInput()",className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Создать диаграмму"}),p("button",{onClick:"closeManualInput()",className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",children:"Отмена"})]})]})]})}),p("div",{id:"loadingIndicator",className:"hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p("div",{className:"bg-white rounded-lg p-8",children:p("div",{className:"flex items-center",children:[p("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mr-4"}),p("span",{className:"text-lg",children:"Обработка файла..."})]})})})]}),p("script",{src:"https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"}),p("script",{src:"/static/professional-parser.js"}),p("script",{src:"/static/d3-visualization.js"}),p("script",{src:"/static/org-chart-enhanced.js"})]}),{title:"Организационная структура"}));V.post("/api/parse",async e=>{try{const r=(await e.req.formData()).get("file");if(!r)return e.json({success:!1,error:"No file provided"},400);const s=r.name.toLowerCase();let n={success:!1,error:"Unsupported file type"};return s.endsWith(".xlsx")?n=await bn(r):s.endsWith(".docx")?n=await En(r):s.endsWith(".pdf")?n=await Cn(r):s.endsWith(".pptx")&&(n=await Sn(r)),e.json(n)}catch(t){return console.error("Parse error:",t),e.json({success:!1,error:"Failed to parse file"},500)}});V.post("/api/import-google-sheets",async e=>{try{const{url:t}=await e.req.json();if(!t)return e.json({success:!1,error:"No URL provided"},400);const r=t.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);if(!r)return e.json({success:!1,error:"Invalid Google Sheets URL"},400);const n=`https://docs.google.com/spreadsheets/d/${r[1]}/export?format=csv`,i=await fetch(n);if(!i.ok)return e.json({success:!1,error:"Failed to fetch Google Sheets data"},500);const a=await i.text();return e.json({success:!0,csv:a,message:"CSV data fetched successfully"})}catch(t){return console.error("Google Sheets import error:",t),e.json({success:!1,error:"Failed to import from Google Sheets"},500)}});V.post("/api/export-google-sheets",async e=>{try{const{structure:t}=await e.req.json();if(!t)return e.json({success:!1,error:"No structure provided"},400);const r=Nn(t);return e.json({success:!0,csv:r,instructions:"Copy this CSV data and paste it into a new Google Sheets document"})}catch(t){return console.error("Export error:",t),e.json({success:!1,error:"Failed to export structure"},500)}});V.post("/api/process-document-url",async e=>{try{const{url:t,fileName:r}=await e.req.json();if(!t)return e.json({success:!1,error:"No URL provided"},400);const s=await fetch(t);if(!s.ok)return e.json({success:!1,error:"Failed to fetch document"},500);const n=s.headers.get("content-type")||"";let i="";if(r!=null&&r.endsWith(".pdf")||n.includes("pdf"))return e.json({success:!1,error:"PDF processing should be done client-side",needsClientProcessing:!0});if(r!=null&&r.endsWith(".docx")||n.includes("wordprocessingml")){const o=await s.arrayBuffer();i=await xn(o)}else{if(r!=null&&r.endsWith(".xlsx")||n.includes("spreadsheetml"))return e.json({success:!1,error:"Excel processing should be done client-side",needsClientProcessing:!0});if(r!=null&&r.endsWith(".pptx")||n.includes("presentationml"))return e.json({success:!1,error:"PowerPoint processing should be done client-side",needsClientProcessing:!0});i=await s.text()}const a=wn(i);return e.json({success:!0,structure:a,text:i})}catch(t){return console.error("Document processing error:",t),e.json({success:!1,error:"Failed to process document"},500)}});async function xn(e){return new TextDecoder("utf-8").decode(e).replace(/[^\x20-\x7E\u0400-\u04FF\n\r\t]/g," ").replace(/\s+/g," ").trim()}function wn(e){const t=e.split(`
`).filter(l=>l.trim()),r=/([А-ЯЁ][а-яё]+\s+[А-ЯЁ][а-яё]+\s+[А-ЯЁ][а-яё]+)|([А-ЯЁ][а-яё]+\s+[А-ЯЁ][а-яё]+)/g,s=/начальник|заместитель|руководитель|директор|менеджер|специалист|координатор/gi,n=[];t.forEach((l,c)=>{const f=l.match(r);l.match(s),f&&f.length>0&&f.forEach(d=>{if(d.split(" ").length>=2){const h={name:d.trim(),title:"",department:"",level:5};for(let g=-2;g<=2;g++)if(t[c+g]&&t[c+g].match(s)){const m=t[c+g].match(/.*?(начальник|заместитель|руководитель|директор|менеджер|специалист|координатор).*/gi);if(m){h.title=m[0].trim();break}}h.title.toLowerCase().includes("генеральный")||h.title.toLowerCase().includes("президент")?h.level=1:h.title.toLowerCase().includes("заместитель")&&h.title.toLowerCase().includes("начальника управления")||h.title.toLowerCase().includes("начальник управления")||h.title.toLowerCase().includes("директор")?h.level=2:h.title.toLowerCase().includes("начальник отдела")?h.level=3:h.title.toLowerCase().includes("заместитель начальника отдела")?h.level=4:h.title.toLowerCase().includes("руководитель")?h.level=3:h.title.toLowerCase().includes("главный")?h.level=4:h.title.toLowerCase().includes("ведущий")||h.title.toLowerCase().includes("старший")?h.level=5:h.level=6,n.push(h)}})}),n.sort((l,c)=>l.level-c.level);const i={id:"root",name:"Организация",title:"",children:[]},a=new Map;n.forEach(l=>{a.has(l.level)||a.set(l.level,[]),a.get(l.level).push({id:`emp-${Math.random().toString(36).substr(2,9)}`,name:l.name,title:l.title||"Сотрудник",children:[]})});const o=Array.from(a.keys()).sort((l,c)=>l-c);for(let l=0;l<o.length;l++){const c=o[l],f=a.get(c);if(l===0)i.children.push(...f);else{const d=o[l-1],h=a.get(d);f.forEach((g,v)=>{const m=Math.floor(v*h.length/f.length);h[Math.min(m,h.length-1)].children.push(g)})}}return i.children.length===1?i.children[0]:i}V.post("/api/parse-manual",async e=>{try{const{input:t}=await e.req.json();if(!t)return e.json({success:!1,error:"No input provided"},400);try{const r=JSON.parse(t);return e.json({success:!0,data:r})}catch{const r=jn(t);return e.json(r)}}catch(t){return console.error("Manual parse error:",t),e.json({success:!1,error:"Failed to parse input"},500)}});async function bn(e){try{return{success:!1,error:"Excel parsing should be done client-side"}}catch{return{success:!1,error:"Failed to parse Excel file"}}}async function En(e){try{return{success:!1,error:"Word parsing should be done client-side"}}catch{return{success:!1,error:"Failed to parse Word file"}}}async function Cn(e){try{return{success:!1,error:"PDF parsing should be done client-side"}}catch{return{success:!1,error:"Failed to parse PDF file"}}}async function Sn(e){try{return{success:!1,error:"PowerPoint parsing should be done client-side"}}catch{return{success:!1,error:"Failed to parse PowerPoint file"}}}function Nn(e){const t=[];t.push("Name,Title,Department,Email,Parent");function r(s,n=""){const i=[s.name||"",s.title||"",s.department||"",s.email||"",n].map(a=>`"${a}"`).join(",");t.push(i);for(const a of s.children||[])r(a,s.name)}return r(e),t.join(`
`)}function jn(e){var t;try{const r=e.split(`
`).filter(i=>i.trim());if(r.length===0)return{success:!1,error:"Empty input"};const s={id:"root",name:"",children:[]},n=[{node:s,level:-1}];for(const i of r){const a=(((t=i.match(/^[ \t]*/))==null?void 0:t[0].length)||0)/2,l=i.trim().split("-").map(d=>d.trim()),c={id:`node-${Math.random().toString(36).substr(2,9)}`,name:l[0]||"",title:l[1]||"",children:[]};for(;n.length>0&&n[n.length-1].level>=a;)n.pop();n[n.length-1].node.children.push(c),n.push({node:c,level:a})}return s.children.length===1?{success:!0,data:s.children[0]}:{success:!0,data:s}}catch{return{success:!1,error:"Failed to parse text input"}}}const Bt=new Pr,An=Object.assign({"/src/index.tsx":V});let Fr=!1;for(const[,e]of Object.entries(An))e&&(Bt.route("/",e),Bt.notFound(e.notFoundHandler),Fr=!0);if(!Fr)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{Bt as default};
